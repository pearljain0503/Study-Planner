<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyFlow</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Boxicons -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="ToDo/main.css">
  <style>
    :root {
      --primary-color: #4EA685;
      --secondary-color: #57B894;
      --white: #ffffff;
      --gray: #efefef;
      --gray-2: #757575;
    }

    * {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--gray);
    }

    .container {
      max-width: 400px;
      width: 100%;
      margin: auto;
      padding-top: 50px;
    }

    .form-card {
      padding: 2rem;
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: 0.5s;
    }

    .hidden {
      display: none;
    }

    .input-group {
      margin: 1rem 0;
    }

    .input-group-text {
      background: #efefef;
      border: none;
      border-radius: .5rem 0 0 .5rem;
      color: #757575;
      font-size: 1.2rem;
    }

    .form-control {
      background: #efefef;
      border: none;
      border-radius: 0 .5rem .5rem 0;
      padding: .8rem;
    }

    button {
      width: 100%;
      padding: .8rem;
      border: none;
      border-radius: .5rem;
      background: var(--primary-color);
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }

    button:hover {
      background: var(--secondary-color);
    }

    b.pointer {
      cursor: pointer;
      color: var(--primary-color);
    }

    #welcomeMsgAuth {
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 1rem;
    }

    /* Dashboard Styles */
    .sidebar {
      width: 220px;
      background: linear-gradient(180deg, #4EA685, #57B894);
      position: fixed;
      height: 100%;
      color: var(--white);
      transition: 0.3s;
      display: none;
    }

    .sidebar h2 {
      text-align: center;
      padding: 1rem 0;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar ul li {
      padding: 15px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: 0.3s;
    }

    .sidebar ul li i {
      margin-right: 10px;
      font-size: 1.2rem;
    }

    .sidebar ul li:hover,
    .sidebar ul li.active {
      background-color: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
    }

    .main-content {
      margin-left: 220px;
      padding: 20px;
      display: none;
    }

    .navbar-custom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 5px 15px;
    }

    .card-custom {
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 8px 20px;
      background: #fff;
      transition: transform 0.3s;
    }

    .card-custom:hover {
      transform: scale(1.05);
    }

    .sticky-note {
      width: 200px;
      min-height: 150px;
      padding: 10px;
      margin: 10px;
      background: #fffbea;
      border-radius: 10px;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 6px 12px;
      animation: fadeIn 0.5s;
    }

    .notes-container {
      display: flex;
      flex-wrap: wrap;
    }

    .progress {
      height: 10px;
      border-radius: 5px;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(-10px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Kanban Board Styling */
    #kanban-board {
      min-height: 80vh;
    }

    .kanban-lane {
      padding: 1rem;
      border-radius: 10px;
    }

    .task-cards .card {
      cursor: grab;
    }
  </style>
</head>

<body>

  <!-- AUTH FORMS -->
  <div class="container" id="authContainer">
    <div id="welcomeMsgAuth">Welcome to StudyFlow!</div>

    <!-- SIGNUP FORM -->
    <form id="signupForm" class="form-card">
      <h3 class="text-center">Sign Up</h3>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bxs-user'></i></span>
        <input type="text" id="signupName" class="form-control" placeholder="Name" required>
      </div>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bx-mail-send'></i></span>
        <input type="email" id="signupEmail" class="form-control" placeholder="Email" required>
      </div>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bxs-lock-alt'></i></span>
        <input type="password" id="signupPassword" class="form-control" placeholder="Password" required>
      </div>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bxs-lock-alt'></i></span>
        <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Password" required>
      </div>
      <button type="submit">Sign Up</button>
      <p class="text-center mt-2">Already have an account? <b class="pointer" onclick="toggleForms()">Login</b></p>
    </form>

    <!-- LOGIN FORM -->
    <form id="loginForm" class="form-card hidden">
      <h3 class="text-center">Login</h3>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bxs-user'></i></span>
        <input type="email" id="loginEmail" class="form-control" placeholder="Email" required>
      </div>
      <div class="input-group">
        <span class="input-group-text"><i class='bx bxs-lock-alt'></i></span>
        <input type="password" id="loginPassword" class="form-control" placeholder="Password" required>
      </div>
      <button type="submit">Login</button>
      <p class="text-center mt-2">Don't have an account? <b class="pointer" onclick="toggleForms()">Sign Up</b></p>
    </form>
  </div>

  <!-- DASHBOARD -->
  <div class="sidebar" id="sidebar">
    <h2>StudyFlow</h2>
    <ul>
      <li class="active" onclick="showSection('dashboard', this)"><i class='bx bxs-dashboard'></i> Dashboard</li>
      <li onclick="showSection('tasks', this)"><i class='bx bxs-check-circle'></i> Tasks</li>
      <li onclick="showSection('notes', this)"><i class='bx bxs-note'></i> Sticky Notes</li>
      <li onclick="showSection('analytics', this)"><i class='bx bxs-bar-chart-alt-2'></i> Analytics</li>
      <li onclick="logout()"><i class='bx bxs-log-out-circle'></i> Logout</li>
    </ul>
  </div>

  <div class="main-content" id="dashboardContent">
    <div class="navbar-custom">
      <div id="welcomeMsgDashboard">Welcome!</div>
      <div id="currentDate"></div>
    </div>

    <!-- Quote -->
    <div class="card-custom" id="quoteCard">
      <h5>Daily Motivation</h5>
      <p id="dailyQuote">Loading...</p>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard" class="section">
      <div class="row">
        <div class="col-md-4">
          <div class="card-custom">
            <h5>Total Tasks</h5>
            <p id="totalTasks" style="font-size:1.5rem; font-weight:600;">0</p>
            <div class="progress">
              <div id="tasksProgress" class="progress-bar" role="progressbar" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card-custom">
            <h5>Completed Tasks</h5>
            <p id="completedTasks" style="font-size:1.5rem; font-weight:600;">0</p>
            <div class="progress">
              <div id="completedProgress" class="progress-bar bg-success" role="progressbar" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card-custom">
            <h5>Notes Count</h5>
            <p id="notesCount" style="font-size:1.5rem; font-weight:600;">0</p>
            <div class="progress">
              <div id="notesProgress" class="progress-bar bg-warning" role="progressbar" style="width:0%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tasks Section (Kanban Board) -->
    <div id="tasks" class="sectio n hidden">
      <div id="todo-root"></div>
      <h3 class="mb-3">Task Board</h3>
      <!-- Kanban Modals and Board -->
      <div class="modal fade" id="addUpdateTaskModal" tabindex="-1" aria-labelledby="addUpdateTaskModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title fs-5" id="addUpdateTaskModalLabel">Add Task</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                onclick="this.blur()"></button>
            </div>
            <form id="addUpdateTaskForm">
              <div class="modal-body">
                <input type="hidden" id="taskId">
                <div class="mb-3">
                  <label for="taskTitle" class="form-label">Title</label>
                  <input type="text" class="form-control" id="taskTitle" required>
                </div>
                <div class="mb-3">
                  <label for="taskDescription" class="form-label">Description</label>
                  <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                </div>
                <div class="mb-3">
                  <label for="taskCategory" class="form-label">Category</label>
                  <select class="form-select" id="taskCategory">
                    <option>Personal</option>
                    <option>Work</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="taskPriority" class="form-label">Priority</label>
                  <select class="form-select" id="taskPriority">
                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                  onclick="this.blur()">Close</button>
                <button type="submit" class="btn btn-primary" id="btnAddUpdateTask">Add Task</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Delete Modal -->
      <div class="modal fade" id="deleteTaskModal" tabindex="-1" aria-labelledby="deleteTaskModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title fs-5" id="deleteTaskModalLabel">Delete Task</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                onclick="this.blur()"></button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to delete this task?</p>
              <p class="small text-danger">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                onclick="this.blur()">Cancel</button>
              <button type="button" class="btn btn-danger" id="btnDeleteTask">Delete Task</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Kanban Board -->
      <div class="container-fluid mt-4">
        <div class="row bg-light" id="kanban-board">
          <div class="col-md-4">
            <div class="kanban-lane bg-secondary-subtle" id="todoLane">
              <div class="d-flex justify-content-between align-items-center">
                <h4>To Do</h4>
                <button class="btn btn-sm btn-outline-primary" id="btnAddTaskShortcut" data-bs-toggle="modal"
                  data-bs-target="#addUpdateTaskModal"><i class="bi bi-plus"></i></button>
              </div>
              <div class="task-cards"></div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="kanban-lane bg-secondary-subtle" id="inProgressLane">
              <h4>In Progress</h4>
              <div class="task-cards"></div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="kanban-lane bg-secondary-subtle" id="doneLane">
              <h4>Done</h4>
              <div class="task-cards"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast -->
      <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="messageToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="toast-header">
            <strong class="me-auto"><i class="bi bi-kanban"></i> Task Board</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" onclick="this.blur()"></button>
          </div>
          <div class="toast-body">Task <strong>Added</strong> Successfully!</div>
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div id="notes" class="section hidden">
      <h3>Sticky Notes</h3>
      <div class="card-custom">
        <textarea id="noteContent" placeholder="Write your note here..."></textarea>
        <button onclick="addNote()">Add Note</button>
      </div>
      <div class="notes-container" id="notesContainer"></div>
    </div>

    <!-- Analytics -->
    <div id="analytics" class="section hidden">
      <h3>Analytics</h3>
      <div class="card-custom">
        <canvas id="tasksChart" height="150"></canvas>
      </div>
      <div class="card-custom">
        <canvas id="notesChart" height="150"></canvas>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ---------------- AUTH ----------------
    function toggleForms() { document.getElementById('signupForm').classList.toggle('hidden'); document.getElementById('loginForm').classList.toggle('hidden'); }

    document.getElementById('signupForm').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const pass = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('confirmPassword').value;
      if (pass !== confirm) { alert("Passwords do not match!"); return; }
      let users = JSON.parse(localStorage.getItem('sf_users')) || [];
      if (users.find(u => u.email === email)) { alert("User already exists!"); return; }
      users.push({ name, email, password: pass });
      localStorage.setItem('sf_users', JSON.stringify(users));
      alert("Signup successful! Please login."); toggleForms(); e.target.reset();
    });

    document.getElementById('loginForm').addEventListener('submit', e => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPassword').value;
      let users = JSON.parse(localStorage.getItem('sf_users')) || [];
      let user = users.find(u => u.email === email && u.password === pass);
      if (!user) { alert("Invalid credentials!"); return; }
      localStorage.setItem('sf_currentUser', JSON.stringify(user));
      showDashboard(user);
    });

    function showDashboard(user) {
      document.getElementById('authContainer').style.display = 'none';
      document.getElementById('sidebar').style.display = 'block';
      document.getElementById('dashboardContent').style.display = 'block';
      document.getElementById('welcomeMsgDashboard').innerText = `Welcome, ${user.name}!`;
      updateDate(); loadQuote(); loadTasks(); loadNotes();
    }

    function updateDate() { document.getElementById('currentDate').innerText = new Date().toDateString(); }
    async function loadQuote() {
      try {
        const res = await fetch('https://api.quotable.io/random');
        const data = await res.json();
        document.getElementById('dailyQuote').innerText = `"${data.content}" — ${data.author}`;
      } catch (err) {
        console.warn("Quote API failed:", err);
        document.getElementById('dailyQuote').innerText = "Stay focused and keep going!";
      }
    }
    function showSection(id, elem) { document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); document.querySelectorAll('.sidebar ul li').forEach(li => li.classList.remove('active')); elem.classList.add('active'); }
    function logout() { localStorage.removeItem('sf_currentUser'); location.reload(); }

    // --- NOTES ---
    let notes = [];
    function loadNotes() { const user = JSON.parse(localStorage.getItem('sf_currentUser')); notes = JSON.parse(localStorage.getItem(`sf_notes_${user.email}`)) || []; renderNotes(); }
    function addNote() { const c = document.getElementById('noteContent').value.trim(); if (!c) return; const user = JSON.parse(localStorage.getItem('sf_currentUser')); notes.push({ content: c }); localStorage.setItem(`sf_notes_${user.email}`, JSON.stringify(notes)); document.getElementById('noteContent').value = ''; renderNotes(); }
    function renderNotes() { const c = document.getElementById('notesContainer'); c.innerHTML = ''; notes.forEach(n => { const d = document.createElement('div'); d.className = 'sticky-note'; d.innerText = n.content; c.appendChild(d); }); }

    // --- KANBAN BOARD ---
    const addUpdateTaskForm = document.querySelector('#addUpdateTaskForm'); const txtTaskId = document.querySelector('#taskId'); const txtTaskTitle = document.querySelector('#taskTitle'); const txtTaskDescription = document.querySelector('#taskDescription'); const choiceTaskCategory = document.querySelector('#taskCategory'); const choiceTaskPriority = document.querySelector('#taskPriority'); const addUpdateTaskModal = document.querySelector('#addUpdateTaskModal'); const deleteTaskModal = document.querySelector('#deleteTaskModal'); const btnDeleteTask = document.querySelector('#btnDeleteTask'); const messageToast = document.querySelector('#messageToast'); const todoLaneCards = document.querySelector('#todoLane .task-cards'); const inProgressLaneCards = document.querySelector('#inProgressLane .task-cards'); const doneLaneCards = document.querySelector('#doneLane .task-cards'); const btnAddTaskShortcut = document.querySelector('#btnAddTaskShortcut'); let kanbanTasks = []; let draggedTaskId = null; const TASKS_KEY = "sf_kanban_tasks"; const laneNameToDOMElementMapping = { todo: todoLaneCards, inProgress: inProgressLaneCards, done: doneLaneCards }; const laneIdToLaneNameMapping = { todoLane: 'todo', inProgressLane: 'inProgress', doneLane: 'done' }; const categoriesColor = { Personal: 'text-bg-info', Work: 'text-bg-dark' }; const prioritiesColor = { Low: 'text-bg-success', Medium: 'text-bg-warning', High: 'text-bg-danger' };

    function clearAllFields() { txtTaskId.value = ''; txtTaskTitle.value = ''; txtTaskDescription.value = ''; choiceTaskCategory.value = 'Personal'; choiceTaskPriority.value = 'Low'; }
    function createTaskCard(id, t, d, c, p) { const card = document.createElement('div'); card.classList.add('card', 'my-3'); card.setAttribute('draggable', true); card.dataset.taskId = id; card.innerHTML = `<div class="card-body"><h5 class="card-title">${t}</h5><p class="card-text small">${d}</p><div class="d-flex justify-content-between align-items-center"><div><span class="badge ${categoriesColor[c]}">${c}</span><span class="badge ${prioritiesColor[p]}">${p}</span></div><div><button class="btn btn-sm btn-warning edit-task" data-task-id="${id}"><i class="bi bi-pencil-square"></i></button><button class="btn btn-sm btn-danger delete-task" data-task-id="${id}"><i class="bi bi-trash3"></i></button></div></div></div>`; card.addEventListener('dragstart', e => draggedTaskId = e.target.dataset.taskId); return card; }
    function getTaskObj(t, d, c, p, id = null, lane = 'todo') { return { id: id ? id : Date.now(), title: t, description: d, category: c, priority: p, lane: lane }; }
    function saveTasks() { const user = JSON.parse(localStorage.getItem('sf_currentUser')); localStorage.setItem(`${TASKS_KEY}_${user.email}`, JSON.stringify(kanbanTasks)); }
    function loadTasks() { const user = JSON.parse(localStorage.getItem('sf_currentUser')); kanbanTasks = JSON.parse(localStorage.getItem(`${TASKS_KEY}_${user.email}`)) || []; renderKanbanTasks(); }
    function renderKanbanTasks() { for (const k in laneNameToDOMElementMapping) { laneNameToDOMElementMapping[k].innerHTML = ''; } kanbanTasks.forEach(t => { const c = createTaskCard(t.id, t.title, t.description, t.category, t.priority); if (t.lane === 'done') { c.removeAttribute('draggable'); c.style.background = '#f0f0f0'; } laneNameToDOMElementMapping[t.lane].appendChild(c); }); }
    function handleAddUpdateTask(e) { e.preventDefault(); const id = txtTaskId.value; const t = txtTaskTitle.value.trim(); if (!t) { alert("Enter task title"); return; } const d = txtTaskDescription.value; const c = choiceTaskCategory.value; const p = choiceTaskPriority.value; if (id) { kanbanTasks = kanbanTasks.map(x => x.id == id ? getTaskObj(t, d, c, p, id, x.lane) : x); } else { kanbanTasks.push(getTaskObj(t, d, c, p)); } saveTasks(); renderKanbanTasks(); bootstrap.Modal.getInstance(addUpdateTaskModal).hide(); bootstrap.Toast.getOrCreateInstance(messageToast).show(); clearAllFields(); }
    function handleDeleteTask() { const id = btnDeleteTask.dataset.taskId; kanbanTasks = kanbanTasks.filter(x => x.id != id); saveTasks(); renderKanbanTasks(); bootstrap.Modal.getInstance(deleteTaskModal).hide(); }
    function handleEdit(e) { const b = e.target.closest('.edit-task'); if (b) { const id = b.dataset.taskId; const t = kanbanTasks.find(x => x.id == id); txtTaskId.value = t.id; txtTaskTitle.value = t.title; txtTaskDescription.value = t.description; choiceTaskCategory.value = t.category; choiceTaskPriority.value = t.priority; bootstrap.Modal.getOrCreateInstance(addUpdateTaskModal).show(); } }
    function handlePrepareDelete(e) { const b = e.target.closest('.delete-task'); if (b) { btnDeleteTask.dataset.taskId = b.dataset.taskId; bootstrap.Modal.getOrCreateInstance(deleteTaskModal).show(); } }
    function enableDragDrop() { document.querySelectorAll('.kanban-lane').forEach(l => { l.addEventListener('dragover', e => e.preventDefault()); l.addEventListener('drop', e => { const id = e.target.closest('.kanban-lane').id; kanbanTasks = kanbanTasks.map(t => t.id == draggedTaskId ? { ...t, lane: laneIdToLaneNameMapping[id] } : t); saveTasks(); renderKanbanTasks(); }); }); }

    const currentUser = JSON.parse(localStorage.getItem('sf_currentUser'));
    if (currentUser) { addUpdateTaskForm.addEventListener('submit', handleAddUpdateTask); document.querySelector('#kanban-board').addEventListener('click', handleEdit); document.querySelector('#kanban-board').addEventListener('click', handlePrepareDelete); btnDeleteTask.addEventListener('click', handleDeleteTask); enableDragDrop(); loadTasks(); }
  </script>
  <script src="ToDo/app.js"></script>
</body>
</html>